## Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

**Ответ:**

В Linux:
```shell
vagrant@vagrant:~$ ip -br link show
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
eth0             UP             08:00:27:73:60:cf <BROADCAST,MULTICAST,UP,LOWER_UP>
```
В Windows:
```commandline
PS C:\Users\Anatol> netsh interface show interface

Состояние адм.  Состояние     Тип              Имя интерфейса
---------------------------------------------------------------------
Запрещен       Отключен       Выделенный       Ethernet 4
Разрешен       Отключен       Выделенный       Ethernet 2
Разрешен       Подключен      Выделенный       VirtualBox Host-Only Network
Разрешен       Подключен      Выделенный       Ethernet 5
Разрешен       Подключен      Выделенный       Ethernet
```

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

**Ответ:**

Для распознавания соседа по сетевому интерфейсу используется протокол LLDP.

В Linux пакет устанавливается командой `apt install lldpd`.

Для управления и просмотром информации о работе LLDP в Linux применяются команды `lldpcli` и `lldpctl`.

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

**Ответ:**

Для разделения коммутатора на несколько виртуальных сетей используется технология VLAN.

В Linux может быть использован следующий пакет `apt install vlan`.
Для настройки VLAN через командную строку можно использовать предустановленный пакет `iproute2`.
Пример настройки через `iproute2`:
```shell
root@vagrant:~# ip -br l
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
eth0             UP             08:00:27:73:60:cf <BROADCAST,MULTICAST,UP,LOWER_UP>

root@vagrant:~# ip link add link eth0 name eth0.100 type vlan id 100

root@vagrant:~# ip -br l
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
eth0             UP             08:00:27:73:60:cf <BROADCAST,MULTICAST,UP,LOWER_UP>
eth0.100@eth0    DOWN           08:00:27:73:60:cf <BROADCAST,MULTICAST>

root@vagrant:~# ip link set dev eth0.100 up

root@vagrant:~# ip -br l
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
eth0             UP             08:00:27:73:60:cf <BROADCAST,MULTICAST,UP,LOWER_UP>
eth0.100@eth0    UP             08:00:27:73:60:cf <BROADCAST,MULTICAST,UP,LOWER_UP>
```

Настройка VLAN может быть задана через файл `/etc/network/interfaces`:
```shell
auto vlan1400
iface vlan1400 inet static
        address 192.168.1.1
        netmask 255.255.255.0
        vlan_raw_device eth0
```

4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

**Ответ:**

В Linux для агрегации нескольких сетевых интерфейсов в единый логический интерфейс используется драйвер bonding.
Типы агрегации в зависимости от опций подразделяются на горячее резервирование и балансировку.

Рассмотрим какие опции/режимы агрегации бывают (по умолчанию используется balance-rr):

- Active-backup – режим резервирования. В этом режиме один сетевой интерфейс активный, а второй в режиме ожидания. 
Когда основной выходит из строя, второй принимает работу на себя. Таким образом обеспечивается стабильный доступ.

- Balance-rr – пакеты отправляются последовательно. 
Этот режим применяется для балансировки нагрузки и отказоустойчивости.

- 802.3ad – при таком режиме задействуются сразу все сетевые карты. 
(этот режим должен поддерживаться и на коммутаторе)

- Balance-xor – режим применяется для отказоустойчивости и балансировки. 
Одна и та же сетевая карта передает пакеты одним и тем же получателям.

- Broadcast – этот режим передает все пакеты на все сетевые карты.

- Balance-tlb – режим адаптивной балансировки передачи. 
Исходящий трафик распределяется в зависимости от загруженности каждой сетевой карты (определяется скоростью загрузки). 
Не требует дополнительной настройки на коммутаторе. 
Входящий трафик приходит на текущую сетевую карту. 
Если она выходит из строя, то другая сетевая карта берёт себе MAC адрес вышедшей из строя карты.

- Balance-alb - режим адаптивной балансировки нагрузки. 
Включает в себя политику balance-tlb плюс осуществляет балансировку входящего трафика. 
Не требует дополнительной настройки на коммутаторе. 
Балансировка входящего трафика достигается путём ARP переговоров. 
Драйвер bonding перехватывает ARP ответы, отправляемые с локальных сетевых карт наружу, и переписывает MAC адрес источника на один из уникальных MAC адресов сетевой карты, участвующей в объединении. 
Таким образом различные пиры используют различные MAC адреса сервера. 
Балансировка входящего трафика распределяется последовательно (round-robin) между интерфейсами.

Пример конфига в файле /etc/network/interfaces:
```shell
# Define slaves   
auto eth0
iface eth0 inet manual
    bond-master bond0
    bond-primary eth0
    bond-mode active-backup
   
auto wlan0
iface wlan0 inet manual
    wpa-conf /etc/network/wpa.conf
    bond-master bond0
    bond-primary eth0
    bond-mode active-backup

# Define master
auto bond0
iface bond0 inet dhcp
    bond-slaves none
    bond-primary eth0
    bond-mode active-backup
    bond-miimon 100
```

5. Сколько IP адресов в сети с маской /29? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

**Ответ:**

- Сколько IP адресов в сети с маской /29?

Максимум можно использовать 6 адресов (плюс адрес сети и широковещательный).

- Сколько /29 подсетей можно получить из сети с маской /24

Можно получить 32 подсети.

- Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

10.10.10.0/29, 10.10.10.8/29, 10.10.10.16/29.

6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

**Ответ:**

Можно задействовать подсеть из диапазона 100.64.0.0/10, так как данная подсеть 
рекомендована согласно RFC 6598 для использования в качестве адресов для CGN.

Из расчета того, что достаточно максимум 40-50 хостов внутри сети, 
то можно выбрать подсеть 100.64.0.0/26 (диапазон адресов 100.64.0.1 - 100.64.0.62).

7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

**Ответ:**

Примеры команд в Windows.

- отображение таблицы ARP для всех интерфейсов:
```commandline
PS C:\Users\Anatol> arp -a

Интерфейс: 192.168.56.1 --- 0x3
  адрес в Интернете      Физический адрес      Тип
  192.168.56.255        ff-ff-ff-ff-ff-ff     статический
  224.0.0.2             01-00-5e-00-00-02     статический
  224.0.0.22            01-00-5e-00-00-16     статический
  224.0.0.251           01-00-5e-00-00-fb     статический
  224.0.0.252           01-00-5e-00-00-fc     статический
  239.255.255.250       01-00-5e-7f-ff-fa     статический
```
- полная очистка ARP кэша:
```commandline
C:\Windows\system32>netsh interface ip delete arpcache
```
- удаление конкретного ip адреса:
```commandline
C:\Windows\system32>arp -d 192.168.0.100
```

Примеры команд в Linux.

- отображение таблицы ARP:
```shell
vagrant@vagrant:~$ ip neigh
10.0.2.2 dev eth0 lladdr 52:54:00:12:35:02 DELAY
10.0.2.3 dev eth0 lladdr 52:54:00:12:35:03 STALE
```
- полная очистка ARP для интерфейса eth0:
```shell
vagrant@vagrant:~$ sudo ip neigh flush dev eth0
```
- удаление конкретного ip адреса:
```shell
vagrant@vagrant:~$ sudo ip neigh del 10.0.2.3 dev eth0
```